import{a as U}from"./chunk-YPP5EWNF.js";import{a as C,c as k,f as R,j as T,k as D,l as F,o as N}from"./chunk-CGGJSKC2.js";import"./chunk-PG33KLFS.js";import{Ea as l,Ra as S,Rb as E,Sb as M,Tb as A,U as x,Va as c,Z as v,_ as b,cb as p,db as i,eb as a,fb as y,jb as I,kb as d,mb as u,nb as w,ob as n,pb as P,qb as g,tb as h,ub as _,vb as f}from"./chunk-TZCEURQS.js";function O(s,t){if(s&1&&(i(0,"li"),n(1),i(2,"span"),n(3),a()()),s&2){let e=t.$implicit;l(),g("",e.email," \u2014 "),l(),w("text-green-600",e.ok),l(),P(e.message)}}function V(s,t){if(s&1&&(i(0,"div",21)(1,"ul",22),c(2,O,4,4,"li",9),a()()),s&2){let e=u();l(2),p("ngForOf",e.presetResults)}}function H(s,t){if(s&1){let e=I();i(0,"li")(1,"div",23)(2,"div")(3,"div",24),n(4),i(5,"span",25),n(6),a()(),i(7,"div",26),n(8),a()(),i(9,"div",27)(10,"button",28),d("click",function(){let m=v(e).$implicit,o=u();return b(o.editarProgramadorHandler(m.uid))}),n(11,"Editar"),a(),i(12,"button",29),d("click",function(){let m=v(e).$implicit,o=u();return b(o.desactivarHandler(m.uid))}),n(13,"Desactivar"),a()()()()}if(s&2){let e=t.$implicit;l(4),g("",e.nombre," "),l(2),g("(",e.email,")"),l(2),P(e.especialidad)}}var W=class s{rolesService=x(U);programadores=[];emailInput="";roleToAssign="programador";assignResult=null;assignMessage="";uidInput="";nombreInput="";roleInput="programador";presetResults=[];constructor(){this.loadProgramadores()}async loadProgramadores(){try{this.programadores=await this.rolesService.obtenerTodosProgramadores()}catch(t){console.error("Error cargando programadores:",t)}}async asignarRolPorEmailHandler(){if(this.emailInput)try{let t=await this.rolesService.asignarRolPorEmail(this.emailInput.trim(),this.roleToAssign);this.assignResult=t,this.assignMessage=t?"Rol asignado correctamente.":"No se encontr\xF3 usuario con ese correo.",t&&await this.loadProgramadores()}catch(t){console.error(t),this.assignResult=!1,this.assignMessage="Error al asignar rol."}}async desactivarHandler(t){if(confirm("Desactivar usuario?"))try{await this.rolesService.desactivarUsuario(t),await this.loadProgramadores()}catch(e){console.error(e)}}async editarProgramadorHandler(t){let e=prompt("Nuevo nombre (dejar vac\xEDo para no cambiar):");if(e===null)return;let r={};e&&(r.nombre=e);try{await this.rolesService.editarProgramador(t,r),await this.loadProgramadores()}catch(m){console.error("Error editando:",m)}}async crearUsuarioPorUID(){if(!this.uidInput)return alert("Proporciona UID");try{await this.rolesService.crearOActualizarUsuario(this.uidInput.trim(),{email:this.emailInput||void 0,nombre:this.nombreInput||"Sin nombre",rol:this.roleInput,fechaRegistro:new Date,activo:!0}),alert("Usuario creado/actualizado en Firestore"),this.uidInput="",this.nombreInput="",await this.loadProgramadores()}catch(t){console.error(t),alert("Error al crear/actualizar usuario")}}async applyPresetRoles(){let t=[{email:"test@mail.com",rol:"admin"},{email:"avila.dianam04@gmail.com",rol:"programador"},{email:"chicotato04@gmail.com",rol:"programador"}];try{this.presetResults=await this.rolesService.asignarRolesBulk(t),await this.loadProgramadores()}catch(e){console.error("Error aplicando preset roles:",e),this.presetResults=t.map(r=>({email:r.email,ok:!1,message:"Error"}))}}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=S({type:s,selectors:[["app-admin-panel"]],decls:33,vars:5,consts:[[1,"p-6","max-w-5xl","mx-auto"],[1,"text-2xl","font-bold","mb-4"],[1,"mb-4"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","mt-2",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"card","p-4","shadow"],[1,"font-semibold"],[1,"divider"],[4,"ngFor","ngForOf"],[1,"mt-6","max-w-2xl","mx-auto","card","p-4","shadow"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-2"],["placeholder","UID de Auth",1,"input","input-bordered",3,"ngModelChange","ngModel"],["placeholder","Nombre",1,"input","input-bordered",3,"ngModelChange","ngModel"],[1,"select","select-bordered",3,"ngModelChange","ngModel"],["value","programador"],["value","admin"],["value","usuario"],[1,"mt-3"],[1,"btn",3,"click"],[1,"ml-3","text-sm","text-gray-600"],[1,"mt-2"],[1,"text-sm"],[1,"flex","justify-between","items-center","py-2"],[1,"font-bold"],[1,"text-sm","text-gray-500"],[1,"text-sm","text-gray-600"],[1,"flex","gap-2"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-error",3,"click"]],template:function(e,r){e&1&&(i(0,"section",0)(1,"h2",1),n(2,"Panel de Administraci\xF3n"),a(),i(3,"div",2)(4,"button",3),d("click",function(){return r.applyPresetRoles()}),n(5,"Aplicar roles iniciales (test + 2 programadores)"),a(),c(6,V,3,1,"div",4),a(),i(7,"div",5)(8,"div",6)(9,"h3",7),n(10,"Programadores registrados"),a(),y(11,"div",8),i(12,"ul"),c(13,H,14,3,"li",9),a()(),i(14,"div",10)(15,"h3",7),n(16,"Crear usuario en Firestore (por UID)"),a(),y(17,"div",8),i(18,"div",11)(19,"input",12),f("ngModelChange",function(o){return _(r.uidInput,o)||(r.uidInput=o),o}),a(),i(20,"input",13),f("ngModelChange",function(o){return _(r.nombreInput,o)||(r.nombreInput=o),o}),a(),i(21,"select",14),f("ngModelChange",function(o){return _(r.roleInput,o)||(r.roleInput=o),o}),i(22,"option",15),n(23,"Programador"),a(),i(24,"option",16),n(25,"Administrador"),a(),i(26,"option",17),n(27,"Usuario"),a()()(),i(28,"div",18)(29,"button",19),d("click",function(){return r.crearUsuarioPorUID()}),n(30,"Crear"),a(),i(31,"span",20),n(32,"Usa esto para registrar en Firestore usuarios que ya existen en Firebase Auth."),a()()()()()),e&2&&(l(6),p("ngIf",r.presetResults==null?null:r.presetResults.length),l(7),p("ngForOf",r.programadores),l(6),h("ngModel",r.uidInput),l(),h("ngModel",r.nombreInput),l(),h("ngModel",r.roleInput))},dependencies:[A,E,M,N,D,F,C,T,k,R],encapsulation:2})};export{W as AdminPanel};
