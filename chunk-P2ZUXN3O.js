import{d as l,e as c,g as d,h as g,j as h,k as m,l as p,m as b,n as v,t as f,u as R}from"./chunk-PG33KLFS.js";import{P as u,U as n,ka as s,n as t,yb as a}from"./chunk-TZCEURQS.js";var D=class i{auth=n(c);firestore=n(v);user=s(null);currentUser=s(null);userRole=s(null);user$=d(this.auth);constructor(){h(this.auth,async e=>{this.currentUser.set(e),e?await this.cargarRolUsuario(e.uid):this.userRole.set(null)})}register(e,r){let o=g(this.auth,e,r);return t(o)}login(e,r){let o=m(this.auth,e,r);return t(o)}loginWithGoogle(){let e=new l;return e.setCustomParameters({prompt:"select_account"}),t(p(this.auth,e))}logout(){let e=b(this.auth);return t(e)}isAuthenticated=a(()=>this.currentUser()!==null);async cargarRolUsuario(e){try{console.log("\u{1F50D} Buscando rol en Firestore para UID:",e);let r=await R(f(this.firestore,"usuarios",e));if(!r.exists()){console.warn("\u26A0\uFE0F Documento no existe en Firestore para UID:",e),this.userRole.set("usuario");return}let o=r.data()?.rol||"usuario";console.log("\u2705 Rol encontrado en Firestore:",o),this.userRole.set(o)}catch(r){console.error("\u274C Error obteniendo rol:",r),this.userRole.set("usuario")}}esAdmin=a(()=>this.userRole()==="admin");esProgramador=a(()=>this.userRole()==="programador");getRol(){return this.userRole()}static \u0275fac=function(r){return new(r||i)};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{D as a};
