import{a as O}from"./chunk-TUSBT566.js";import{a as $}from"./chunk-YPP5EWNF.js";import{o as M}from"./chunk-CGGJSKC2.js";import{A as H,n as V,q as F,r as w,s as T,t as S,v as j,x as z,z as N}from"./chunk-PG33KLFS.js";import{Ea as c,P as E,Ra as k,Rb as C,Sb as D,Tb as A,U as u,Va as g,Z as y,_,a as d,b as p,cb as b,db as r,eb as o,fb as h,jb as v,kb as f,mb as m,ob as s,pb as P,sb as I}from"./chunk-TZCEURQS.js";var x=class n{firestore=u(V);async crearProyecto(t,e){let i=w(this.firestore,"proyectos");return{id:(await F(i,p(d({},e),{owner:t,creadoEn:new Date}))).id}}async actualizarProyecto(t,e){await N(S(this.firestore,"proyectos",t),e)}async eliminarProyecto(t){await T(S(this.firestore,"proyectos",t))}async obtenerProyectosPorProgramador(t){let e=z(w(this.firestore,"proyectos"),H("owner","==",t));return(await j(e)).docs.map(a=>d({id:a.id},a.data()))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=E({token:n,factory:n.\u0275fac,providedIn:"root"})};function q(n,t){if(n&1){let e=v();r(0,"li")(1,"div",8)(2,"div")(3,"div",9),s(4),o(),r(5,"div",10),s(6),o()(),r(7,"div",11)(8,"button",12),f("click",function(){let a=y(e).$implicit,l=m();return _(l.editarProyectoHandler(a))}),s(9,"Editar"),o(),r(10,"button",13),f("click",function(){let a=y(e).$implicit,l=m();return _(l.eliminarProyectoHandler(a.id))}),s(11,"Eliminar"),o()()()()}if(n&2){let e=t.$implicit;c(4),P(e.nombre),c(2),P(e.descripcion)}}function B(n,t){if(n&1){let e=v();r(0,"button",20),f("click",function(){y(e);let a=m().$implicit,l=m();return _(l.responderAsesoria(a.id,"aceptada"))}),s(1,"Aceptar"),o()}}function G(n,t){if(n&1){let e=v();r(0,"button",21),f("click",function(){y(e);let a=m().$implicit,l=m();return _(l.responderAsesoria(a.id,"rechazada"))}),s(1,"Rechazar"),o()}}function J(n,t){if(n&1&&(r(0,"li")(1,"div",14)(2,"div",9),s(3),o(),r(4,"div",15),s(5,"Solicitante: "),r(6,"span",4),s(7),o()(),r(8,"div",16),s(9),o(),r(10,"div",17),g(11,B,2,0,"button",18)(12,G,2,0,"button",19),o()()()),n&2){let e=t.$implicit;c(3),I("",e.fecha," ",e.hora," \u2014 ",e.estado),c(4),P(e.solicitanteEmail||"An\xF3nimo"),c(2),P(e.comentario),c(2),b("ngIf",e.estado==="pendiente"),c(),b("ngIf",e.estado==="pendiente")}}var R=class n{rolesService=u($);projectsService=u(x);asesoriasService=u(O);uid="";proyectos=[];asesorias=[];constructor(){this.init()}async init(){let t=await this.rolesService.obtenerDatosUsuarioActual();t&&(this.uid=t.uid,await this.loadProyectos(),await this.loadAsesorias())}async loadProyectos(){this.uid&&(this.proyectos=await this.projectsService.obtenerProyectosPorProgramador(this.uid))}async crearProyectoHandler(){let t=prompt("Nombre del proyecto:");if(!t)return;let e=prompt("Descripci\xF3n:")||"";await this.projectsService.crearProyecto(this.uid,{nombre:t,descripcion:e}),await this.loadProyectos()}async editarProyectoHandler(t){let e=prompt("Nombre:",t.nombre)||t.nombre,i=prompt("Descripci\xF3n:",t.descripcion)||t.descripcion;await this.projectsService.actualizarProyecto(t.id,{nombre:e,descripcion:i}),await this.loadProyectos()}async eliminarProyectoHandler(t){confirm("Eliminar proyecto?")&&(await this.projectsService.eliminarProyecto(t),await this.loadProyectos())}async loadAsesorias(){if(!this.uid)return;let t=await this.asesoriasService.obtenerSolicitudesPorProgramador(this.uid),e=await Promise.all(t.map(async i=>{if(!i.solicitanteUid)return p(d({},i),{solicitanteEmail:null});try{let a=await this.rolesService.obtenerUsuarioPorId(i.solicitanteUid);return p(d({},i),{solicitanteEmail:a?.email||null})}catch(a){return console.error("Error obteniendo solicitante:",a),p(d({},i),{solicitanteEmail:null})}}));this.asesorias=e}async responderAsesoria(t,e){let i=prompt("Mensaje de confirmaci\xF3n/rechazo (opcional):")||"";await this.asesoriasService.actualizarEstadoSolicitud(t,e,i),await this.loadAsesorias()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-programador-panel"]],decls:18,vars:2,consts:[[1,"p-6","max-w-5xl","mx-auto"],[1,"text-2xl","font-bold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"card","p-4","shadow"],[1,"font-semibold"],[1,"divider"],[1,"btn","btn-sm","mb-3",3,"click"],[4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","py-2"],[1,"font-bold"],[1,"text-sm","text-gray-600"],[1,"flex","gap-2"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"py-2"],[1,"text-sm"],[1,"text-sm","mt-1"],[1,"mt-2","flex","gap-2"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],["class","btn btn-error btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"btn","btn-error","btn-sm",3,"click"]],template:function(e,i){e&1&&(r(0,"section",0)(1,"h2",1),s(2,"Panel del Programador"),o(),r(3,"div",2)(4,"div",3)(5,"h3",4),s(6,"Mis Proyectos"),o(),h(7,"div",5),r(8,"button",6),f("click",function(){return i.crearProyectoHandler()}),s(9,"+ Nuevo Proyecto"),o(),r(10,"ul"),g(11,q,12,2,"li",7),o()(),r(12,"div",3)(13,"h3",4),s(14,"Solicitudes de Asesor\xEDa"),o(),h(15,"div",5),r(16,"ul"),g(17,J,13,7,"li",7),o()()()()),e&2&&(c(11),b("ngForOf",i.proyectos),c(6),b("ngForOf",i.asesorias))},dependencies:[A,C,D,M],encapsulation:2})};export{R as ProgramadorPanel};
